const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/firebase-Bm2_bNUp.js","assets/vendor-D_24E6d6.js","assets/client-BaAXMG-p.js","assets/audio-C_N-pnQi.js","assets/server-legacy-VCnaukn1.js","assets/server-CTIHs7En.js","assets/firestore-DfuMpQeo.js"])))=>i.map(i=>d[i]);
import{c as e,j as t,u as s,e as n,P as r,f as a}from"./vendor-D_24E6d6.js";import{s as o,t as i}from"./firebase-Bm2_bNUp.js";import{u as l,T as c,i as d,a as u,B as m}from"./localization-CeBlo4w0.js";import{b as g}from"./assets-CWSx5ruD.js";import{v as f,s as p,o as x,r as h}from"./utils-Cn72Yc4k.js";import{h as b}from"./audio-C_N-pnQi.js";import{H as y,u as v,a as w,b as j,O as k,R as N,c as E,N as S}from"./router-CrHh28Pl.js";import{I as C,B as M,G as I,a as _,b as L,S as $,c as D,d as R,e as P,f as O,R as A,g as T,X as F,M as U,V as z,h as q,i as B,j as V,k as G,L as K,l as X,C as H,m as Y,A as W,n as Z,o as J,p as Q,q as ee,r as te,s as se,F as ne,t as re,u as ae,D as oe,v as ie,w as le}from"./icons-5E49jRe9.js";import{serverTimestamp as ce,Timestamp as de,where as ue,orderBy as me,limit as ge}from"./firestore-DfuMpQeo.js";import"./client-BaAXMG-p.js";import"./server-legacy-VCnaukn1.js";import"./server-CTIHs7En.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const fe={},pe=function(e,t,s){let n=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const e=document.querySelector("meta[property=csp-nonce]"),s=e?.nonce||e?.getAttribute("nonce");r=t.map(e=>{if((e=function(e){return"/infinite-nonogram/"+e}(e))in fe)return;fe[e]=!0;const t=e.endsWith(".css"),n=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${n}`))return;const r=document.createElement("link");return r.rel=t?"stylesheet":"modulepreload",t||(r.as="script"),r.crossOrigin="",r.href=e,s&&r.setAttribute("nonce",s),document.head.appendChild(r),t?new Promise((t,s)=>{r.addEventListener("load",t),r.addEventListener("error",()=>s(new Error(`Unable to preload CSS for ${e}`)))}):void 0}),n=Promise.all(r.map(e=>Promise.resolve(e).then(e=>({status:"fulfilled",value:e}),e=>({status:"rejected",reason:e}))))}var r;function a(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return n.then(t=>{for(const e of t||[])"rejected"===e.status&&a(e.reason);return e().catch(a)})},xe=e.createContext(void 0),he="1.2.17",be={apiKey:"AIzaSyD2nmb9SCBi_tGBqgRm45SD2Kd3_prls0o",authDomain:"super-nonogram.firebaseapp.com",projectId:"super-nonogram",storageBucket:"super-nonogram.firebasestorage.app",messagingSenderId:"1019221268880",appId:"1:1019221268880:web:8f068f86a5aa14e27fbb15",measurementId:"G-47DNVR0K3D"},ye=()=>{const t=e.useContext(xe);if(!t)throw new Error("useFirebase must be used within a FirebaseProvider");return t},ve=e.createContext(void 0),we={locale:{allowed:{default:"en-GB",list:["en-GB"]},groups:{default:"default",list:["default"]}},pages:{default:"game"},game:{grid:{default:10,min:5,max:15,block:{size:2.5,disabledByError:700},hint:{groupPadding:.65,padding:.05}},difficulty:{default:"medium",list:{easy:.75,medium:.55,hard:.35}},scale:{default:1,min:.5,max:2,step:.05},score:{win:.5,multiplier:1e5,bonus:{perfect:1.5,difficulty:{easy:1,medium:1.25,hard:1.5}},penalty:{time:1e-7,errors:.9,interactions:.5}}},meta:[{httpEquiv:"Content-Security-Policy",content:["default-src 'self'","script-src 'self' https://www.googletagmanager.com https://apis.google.com","connect-src 'self' https://firebase.googleapis.com https://firestore.googleapis.com https://securetoken.googleapis.com https://firebaseinstallations.googleapis.com https://identitytoolkit.googleapis.com https://region1.google-analytics.com https://api.country.is","style-src 'self' 'unsafe-inline'","img-src 'self' data: https://www.googletagmanager.com","font-src 'self'","frame-src 'self' https://super-nonogram.firebaseapp.com","object-src 'none'","base-uri 'self'","form-action 'self'","upgrade-insecure-requests"]},{httpEquiv:"X-Content-Type-Options",content:"nosniff"},{httpEquiv:"Permissions-Policy",content:"geolocation=(), microphone=(), camera=()"},{name:"referrer",content:"strict-origin-when-cross-origin"},{name:"robots",content:"index, follow"}],preload:[{rel:"dns-prefetch",href:"https://apis.google.com"},{rel:"dns-prefetch",href:"https://firebase.googleapis.com"},{rel:"dns-prefetch",href:"https://firestore.googleapis.com"},{rel:"dns-prefetch",href:"https://securetoken.googleapis.com"},{rel:"dns-prefetch",href:"https://firebaseinstallations.googleapis.com"},{rel:"dns-prefetch",href:"https://identitytoolkit.googleapis.com"},{rel:"dns-prefetch",href:"https://www.googletagmanager.com"},{rel:"dns-prefetch",href:"https://region1.google-analytics.com"},{rel:"dns-prefetch",href:"https://api.country.is"},{rel:"dns-preconnect",href:"https://apis.google.com",crossorigin:"anonymous"},{rel:"preconnect",href:"https://firebase.googleapis.com",crossorigin:"anonymous"},{rel:"preconnect",href:"https://firestore.googleapis.com",crossorigin:"anonymous"},{rel:"preconnect",href:"https://securetoken.googleapis.com",crossorigin:"anonymous"},{rel:"preconnect",href:"https://firebaseinstallations.googleapis.com",crossorigin:"anonymous"},{rel:"preconnect",href:"https://identitytoolkit.googleapis.com",crossorigin:"anonymous"},{rel:"preconnect",href:"https://www.googletagmanager.com",crossorigin:"anonymous"},{rel:"preconnect",href:"https://region1.google-analytics.com",crossorigin:"anonymous"},{rel:"preconnect",href:"https://api.country.is",crossorigin:"anonymous"}]},je=new RegExp(g.map(e=>`(${e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")})`).join("|"),"gi"),ke=e=>{const t={a:"4",b:"8",e:"3",g:"9",i:"1",l:"1",o:"0",r:"2",s:"5",t:"7",z:"2"};return e.split("").map((e,s)=>s>0?t[e.toLowerCase()]||"*":e).join("")},Ne=e=>e.replace(je,ke),Ee=()=>Se(f()),Se=e=>Ne(e).replace(/[^A-Za-z0-9*]/g,"").substring(0,50),Ce=e=>`infNono:${e}`,Me=e=>getComputedStyle(document.documentElement).getPropertyValue(e).trim(),Ie=()=>window.innerWidth,_e=()=>window.innerHeight,Le=e=>window.open(e,"_blank","noopener, noreferrer"),$e=e.createContext(void 0),De=e=>16*e,Re=()=>{const[t,s]=e.useState(""),n=e.useRef({xs:0,sm:De(parseFloat(Me("--breakpoint-sm"))),md:De(parseFloat(Me("--breakpoint-md"))),lg:De(parseFloat(Me("--breakpoint-lg"))),xl:De(parseFloat(Me("--breakpoint-xl"))),"2xl":De(parseFloat(Me("--breakpoint-2xl")))}),{width:r}=(t=>{const s=e.useContext(ve),n=e.useRef(!1);if(!s)throw new Error("useResize must be used within a ResizeProvider");return e.useEffect(()=>{if(!t)return;n.current||(t(),n.current=!0);const e=s.subscribe(t);return()=>e()},[s,t]),{width:s.width,height:s.height}})(()=>s(Object.entries(n.current).reverse().find(([e,t])=>r>=t)?.[0]));return{breakpoints:n,currentBreakpoint:t}},Pe=e.createContext(void 0),Oe=()=>{const t=e.useContext($e);if(!t)throw new Error("useSettings must be used within a SettingsProvider");return t},Ae=e.createContext(void 0),Te=()=>{const t=e.useContext(Ae);if(!t)throw new Error("useScale must be used within a ScaleProvider");return t},Fe=()=>{const t=e.useContext(Pe);if(!t)throw new Error("useInteraction must be used within a InteractionProvider");return t},Ue=e.createContext(void 0),ze=e.createContext(void 0),qe=()=>{const t=e.useContext(ze);if(!t)throw new Error("useTimer must be used within a TimerProvider");return t},Be=()=>{const t=e.useContext(Ue);if(!t)throw new Error("useEngine must be used within a EngineProvider");return t},Ve={years:31536e3,months:2592e3,days:86400,hours:3600,minutes:60,seconds:1},Ge=()=>(new Date).getTime(),Ke=e=>{const t={};let s=!1,n=Math.abs(e/1e3);return Object.entries(Ve).forEach(([e,s])=>{t[e]=Math.floor(n/s),n-=(t[e]??0)*s}),Object.fromEntries(Object.entries(t).filter(([e,t])=>!(!s&&"seconds"!==e)||(0!==t&&(s=!0),s)))},Xe=e.createContext(void 0),He=()=>{const t=e.useContext(Xe);if(!t)throw new Error("useAudio must be used within a AudioProvider");return t},Ye=[e.StrictMode,({children:s})=>{const[n,r]=e.useState(Ie()),[a,o]=e.useState(_e()),i=e.useRef(new Set);return e.useEffect(()=>{const e=new ResizeObserver(()=>{r(Ie()),o(_e()),i.current.forEach(e=>e())});return e.observe(document.documentElement),()=>e.disconnect()},[]),e.useEffect(()=>document.documentElement.style.setProperty("--dvw",`${n}px`),[n]),e.useEffect(()=>document.documentElement.style.setProperty("--dvh",`${a}px`),[a]),t.jsx(ve.Provider,{value:{width:n,height:a,subscribe:e=>(i.current.add(e),()=>i.current.delete(e))},children:s})},({children:n})=>{const r=s(),{currentBreakpoint:a}=Re(),[o,i]=e.useState(!1),[l,c]=e.useState(!1),[d,u]=e.useState(null),[m,g]=e.useState(null),[p,x]=e.useState(Se(f())),[h,b]=e.useState("medium"),[y,v]=e.useState(5),[w,j]=e.useState(5),[k,N]=e.useState(!0),[E,S]=e.useState(!0),[C,M]=e.useState(!0),[I,_]=e.useState(!0),[L,$]=e.useState(!0),[D,R]=e.useState(!1),P=e.useRef({user:(localStorage.getItem(Ce("user"))||"").trim()?.length>0?localStorage.getItem(Ce("user")):null,isAuto:"false"!==localStorage.getItem(Ce("isAuto")),showIntersections:"false"!==localStorage.getItem(Ce("showIntersections")),showEffects:"false"!==localStorage.getItem(Ce("showEffects")),isLeaderboardOn:"false"!==localStorage.getItem(Ce("isLeaderboardOn")),isMusicOn:"false"!==localStorage.getItem(Ce("isMusicOn"))}),O=e.useRef(null),A=e.useRef(null),T=e.useCallback(e=>{c(e)},[]),F=e.useCallback((e=null)=>{null===e&&(e=`Nonogrammer*${f().replace(/[^A-Za-z0-9*]/g,"").substring(10)}`),u((e=>Ne(e).replace(/[^A-Za-z0-9*\s]/g,"").replace(/\s+/g," ").substring(0,50))(e))},[]),U=e.useCallback(e=>{void 0===e&&(e=Ee()),x(Se(e))},[]),z=e.useCallback((e="medium")=>{Object.keys(we.game.difficulty.list).includes(e)||(e=we.game.difficulty.default),b(e)},[]),q=e.useCallback(e=>{v(e>=we.game.grid.min&&e<=we.game.grid.max?e:we.game.grid.default)},[]),B=e.useCallback(e=>{j(e>=we.game.grid.min&&e<=we.game.grid.max?e:we.game.grid.default)},[]),V=e.useCallback(N,[N]),G=e.useCallback(S,[S]),K=e.useCallback(M,[M]),X=e.useCallback(_,[_]),H=e.useCallback($,[$]),Y=e.useCallback(R,[R]),W=e.useMemo(()=>we.game.difficulty.list[h]??we.game.difficulty.list[we.game.difficulty.default],[h]),Z=()=>{null!==O.current&&(clearTimeout(O.current),O.current=null)},J=()=>{null!==A.current&&(clearTimeout(A.current),A.current=null)};return e.useEffect(()=>{const e=localStorage.getItem(Ce("user"));F(e??void 0)},[F]),e.useEffect(()=>(Z(),i(!0),O.current=setTimeout(()=>i(!1),500),()=>Z()),[p,h,y,w]),e.useEffect(()=>(J(),l&&(A.current=setTimeout(()=>c(!1),we.game.grid.block.disabledByError)),()=>J()),[l,o]),e.useEffect(()=>{null!==d&&localStorage.setItem(Ce("user"),d)},[d]),e.useEffect(()=>localStorage.setItem(Ce("isAuto"),k.toString()),[k]),e.useEffect(()=>localStorage.setItem(Ce("showIntersections"),E.toString()),[E]),e.useEffect(()=>{localStorage.setItem(Ce("showEffects"),C.toString()),C?document.body.classList.remove("effects-off"):document.body.classList.add("effects-off")},[C]),e.useEffect(()=>localStorage.setItem(Ce("isMusicOn"),L.toString()),[L]),e.useEffect(()=>localStorage.setItem(Ce("isLeaderboardOn"),I.toString()),[I]),e.useEffect(()=>g(r.isLoading||r.error?null:r.country),[r]),e.useEffect(()=>{F(P.current.user),V(P.current.isAuto),G(P.current.showIntersections),K(P.current.showEffects),X(P.current.isLeaderboardOn),H(P.current.isMusicOn)},[F,V,G,K,X,H]),e.useEffect(()=>{["xs","sm"].includes(a)&&(V(!1),G(!1))},[a,V,G]),e.useEffect(()=>{document.documentElement.style.setProperty("--grid-block-size",`${we.game.grid.block.size}rem`),document.documentElement.style.setProperty("--grid-hint-group-padding",`${we.game.grid.hint.groupPadding}rem`),document.documentElement.style.setProperty("--grid-hint-padding",`${we.game.grid.hint.padding}rem`)},[]),t.jsx($e.Provider,{value:{isRefreshing:o,isGlobalError:l,user:d,country:m,seed:p,difficulty:h,probability:W,rows:y,cols:w,isAuto:k,showIntersections:E,showEffects:C,isLeaderboardOn:I,isMusicOn:L,isDrawerShown:D,setIsGlobalError:T,setUser:F,setSeed:U,setDifficulty:z,setRows:q,setCols:B,setIsAuto:V,setShowIntersections:G,setShowEffects:K,setIsLeaderboardOn:X,setIsMusicOn:H,setIsDrawerShown:Y},children:n})},({children:s})=>{const{i18n:n}=l(),[r,a]=e.useState(null),[c,d]=e.useState(null),[u,m]=e.useState(null),[g,f]=e.useState(null),p=e.useMemo(()=>null!==r&&null!==c&&null!==u,[r,c,u]),x=e.useMemo(()=>0===i().length?o(be):i()[0],[]),h=e.useCallback(async(e,t)=>{if(!g)return;const{logEvent:s}=await pe(async()=>{const{logEvent:e}=await import("./firebase-Bm2_bNUp.js").then(e=>e.v);return{logEvent:e}},__vite__mapDeps([0,1,2,3,4,5]));try{s(g,e,t)}catch(n){}},[g]);return e.useEffect(()=>{let e=null;return(async()=>{const{getAuth:t,onAuthStateChanged:s,signInAnonymously:n}=await pe(async()=>{const{getAuth:e,onAuthStateChanged:t,signInAnonymously:s}=await import("./firebase-Bm2_bNUp.js").then(e=>e.w);return{getAuth:e,onAuthStateChanged:t,signInAnonymously:s}},__vite__mapDeps([0,1,2,3,4,5])),r=t(x);a(r),e=s(r,async e=>{if(e)d(e);else{const e=await n(r);d(e.user)}})})(),()=>{e&&e()}},[x]),e.useEffect(()=>{(async()=>{const{getFirestore:e}=await pe(async()=>{const{getFirestore:e}=await import("./firestore-DfuMpQeo.js");return{getFirestore:e}},__vite__mapDeps([6,0,1,2,3,4,5]));m(e(x))})()},[x]),e.useEffect(()=>{(async()=>{const{getAnalytics:e,isSupported:t,setUserProperties:s}=await pe(async()=>{const{getAnalytics:e,isSupported:t,setUserProperties:s}=await import("./firebase-Bm2_bNUp.js").then(e=>e.v);return{getAnalytics:e,isSupported:t,setUserProperties:s}},__vite__mapDeps([0,1,2,3,4,5]));if(await t()){const t=e(x);s(t,{app_version:`${he}`,locale:n.language,user_role:"player"}),f(t)}})()},[x,n.language]),t.jsx(xe.Provider,{value:{app:x,firestore:u,analytics:g,auth:r,user:c,isAuthenticated:p,logEvent:h},children:s})},y,({children:s})=>{const[n,r]=e.useState(we.game.scale.default),[a,o]=e.useState(!1),i=e.useRef(null),l=e.useRef({scale:Number(localStorage.getItem(Ce("scale")))}),c=e=>Math.round(1e3*Math.min(we.game.scale.max,Math.max(we.game.scale.min,e)))/1e3,d=e.useCallback(e=>r(c(e)),[]),u=e.useCallback(e=>{e.shiftKey&&(e.preventDefault(),r(t=>c(t-Math.sign(e.deltaY||e.deltaX)*we.game.scale.step*2)))},[]),m=e=>{if(2===e.touches.length){const[t,s]=e.touches,n=Math.hypot(s.pageX-t.pageX,s.pageY-t.pageY),a=e=>{if(2===e.touches.length){const[t,s]=e.touches,a=5e-4*(Math.hypot(s.pageX-t.pageX,s.pageY-t.pageY)-n);r(e=>Math.min(we.game.scale.max,Math.max(we.game.scale.min,e+a)))}},o=()=>{document.removeEventListener("touchmove",a),document.removeEventListener("touchend",o)};document.addEventListener("touchmove",a,{passive:!1}),document.addEventListener("touchend",o)}},g=()=>{null!==i.current&&(clearTimeout(i.current),i.current=null)};return e.useEffect(()=>(g(),localStorage.setItem(Ce("scale"),n.toString()),document.documentElement.style.setProperty("--scale",n.toString()),o(!0),i.current=setTimeout(()=>o(!1),200),()=>g()),[n]),e.useEffect(()=>(d(l.current.scale&&!isNaN(l.current.scale)?l.current.scale:we.game.scale.default),document.addEventListener("wheel",u,{passive:!1}),document.addEventListener("touchstart",m,{passive:!1}),()=>{document.removeEventListener("wheel",u),document.removeEventListener("touchstart",m)}),[d,u]),t.jsx(Ae.Provider,{value:{scale:n,isScaling:a,setScale:d},children:s})},({children:s})=>{const{isMusicOn:n}=Oe(),r=e.useRef({}),a=e=>r.current[e]?r.current[e]:null,o=e.useCallback(e=>{const t=a(e);t&&n&&("unloaded"===t.state()?(t.load(),t.once("load",()=>t.play())):"loaded"===t.state()&&t.play())},[n]);return e.useEffect(()=>{const e=r.current;return()=>Object.values(e).forEach(e=>e.unload())},[]),e.useEffect(()=>{const e=e=>e.stopImmediatePropagation(),t=t=>{e(t);const s=b.Howler.ctx;s&&"running"!==s.state&&s.resume().then(()=>{})};return document.addEventListener("pointerdown",t,{once:!0}),document.addEventListener("pointerup",e,{once:!0}),()=>{document.removeEventListener("pointerdown",t),document.removeEventListener("pointerup",e)}},[]),t.jsx(Xe.Provider,{value:{ref:a,add:(e,t,s=1)=>{r.current[e]||(r.current[e]=new b.Howl({src:[t],volume:s}))},play:o,volume:(e,t)=>{const s=a(e);s&&s.volume(Math.min(1,Math.max(0,t)))}},children:s})},({children:s})=>{const[n,r]=e.useState(null),[a,o]=e.useState(0),[i,l]=e.useState({}),[c,d]=e.useState(!0),u=e.useRef(null),m=e.useRef(null),g=e.useCallback(()=>{null!==u.current&&(clearInterval(u.current),u.current=null),null!==m.current&&(clearInterval(m.current),m.current=null),d(!0)},[]),f=e.useCallback(()=>{g(),r(null),o(0),l({seconds:0}),d(!0)},[g]),p=e.useCallback(()=>{f(),r(Ge())},[f]),x=e.useCallback(()=>{n&&(o(Math.abs(Ge()-n)),l(Ke(Ge()-n)))},[n]),h=e.useCallback(()=>{g(),x(),u.current=setInterval(x,1e3),n&&(m.current=setInterval(()=>d(e=>!e),500))},[x,g,n]);return e.useEffect(()=>{h()},[h]),e.useEffect(()=>(f(),()=>g()),[f,g]),t.jsx(ze.Provider,{value:{ms:a,timeUnits:i,blink:c,start:p,stop:g,reset:f},children:s})},({children:s})=>{const{isAuto:n,isDrawerShown:r,isRefreshing:a}=Oe(),{isScaling:o}=Te(),[i,l]=e.useState(!1),[c,d]=e.useState("left"),[u,m]=e.useState(void 0),[g,f]=e.useState(void 0),p=e.useCallback(e=>e.classList.contains("game-grid")||e.classList.contains("game-grid-wrapper")||e.classList.contains("game-grid-block"),[]),x=e.useCallback(d,[d]),h=e.useCallback(e=>{if(p(e.target)&&!i&&!o&&(l(!0),n&&"mouse"===e.pointerType))switch(e.button){case 0:d("left");break;case 2:d("right")}},[n,i,o,p]),b=e.useCallback(e=>{p(e.target)&&l(!1)},[p]),y=e.useCallback((e,t)=>{if(e.classList.contains("game-grid-block"))if(!o&&t){const t=Number(e.dataset.row),s=Number(e.dataset.col);m(s),f(t)}else m(void 0),f(void 0)},[o]),v=e.useCallback(e=>y(e.target,!0),[y]),w=e.useCallback(e=>y(e.target,!1),[y]),j=e=>e.preventDefault();return e.useEffect(()=>{m(void 0),f(void 0)},[a]),e.useEffect(()=>(r||(document.addEventListener("pointerdown",h),document.addEventListener("pointerup",b),document.addEventListener("pointercancel",b),document.addEventListener("pointerover",v),document.addEventListener("pointerout",w)),()=>{document.removeEventListener("pointerdown",h),document.removeEventListener("pointerup",b),document.removeEventListener("pointercancel",b),document.removeEventListener("pointerover",v),document.removeEventListener("pointerout",w)}),[r,h,b,v,w]),e.useEffect(()=>(document.addEventListener("contextmenu",j),()=>document.removeEventListener("contextmenu",j)),[]),t.jsx(Pe.Provider,{value:{isClicked:i,isInteracting:c,overCol:u,overRow:g,setIsInteracting:x},children:s})},({children:s})=>{const n=Oe(),{start:r,stop:a,ms:o,reset:i}=qe(),[l,c]=e.useState([]),[d,u]=e.useState([]),[m,g]=e.useState([]),[f,x]=e.useState([]),h=e.useMemo(()=>Array.from({length:n.rows},()=>Array(n.cols).fill(!1)),[n.rows,n.cols]),b=e.useCallback(()=>{if(!n.seed)return;const e=p(n.seed);c(h.map(t=>t.map(()=>e()<n.probability))),u(h),a(),i()},[h,n.seed,n.probability,a,i]),y=e.useMemo(()=>l.flat().length,[l]),v=e.useMemo(()=>l.flat().filter(e=>!0===e).length,[l]),w=e.useMemo(()=>l.flat().filter((e,t)=>!0===e&&!1!==d.flat()[t]).length,[l,d]),j=e.useMemo(()=>l.flat().filter((e,t)=>!0===e&&"left"===d.flat()[t]).length,[l,d]),k=e.useMemo(()=>l.flat().filter((e,t)=>!1===e&&"right"===d.flat()[t]).length,[l,d]),N=e.useMemo(()=>l.flat().filter((e,t)=>!0===e&&"right"===d.flat()[t]||!1===e&&"left"===d.flat()[t]).length,[l,d]),E=e.useMemo(()=>d.flat().filter(e=>!1!==e).length,[d]),S=e.useMemo(()=>E>0,[E]),C=e.useMemo(()=>l.flat().length===n.rows*n.cols&&d.flat().length===l.flat().length,[l,d,n.rows,n.cols]),M=e.useMemo(()=>{if(0===v||0===w||0===j||0===E)return 0;const e=Math.min(N,y)/y,t=Math.min(k,v)/v;return Math.min(Math.max(0,w/v*(1-e*we.game.score.penalty.errors)*(1-t*we.game.score.penalty.interactions)),1)},[y,w,j,k,N,E,v]),I=e.useMemo(()=>{if(0===y)return 0;const e=1/(1+o/y*we.game.score.penalty.time),t=we.game.score.bonus.difficulty[n.difficulty],s=0===N?we.game.score.bonus.perfect:1,r=we.game.grid.min*we.game.grid.min,a=we.game.grid.max*we.game.grid.max,i=1+(y-r)/(a-r)*.5;return Math.trunc(M*we.game.score.multiplier*t*e*s*i)},[M,y,o,N,n.difficulty]),_=e.useMemo(()=>w>=v,[w,v]),L=e.useCallback(({row:e,col:t,hasInteracted:s})=>{u(n=>{const r=[...n];return r[e]=[...r[e]],r[e][t]=s,r})},[]),$=e.useCallback(()=>{if(!C)return;let e,t,s;const r=Array.from({length:n.rows},()=>[]);for(let a=0;a<n.rows;a++){t=[],s=[];for(let o=0;o<n.cols;o++)e=l[a][o],t.push(o),s.push(!(!1===d[a][o]||d[a].slice(0,o).includes(!1)&&d[a].slice(o+1).includes(!1))),(l[a][o+1]!==l[a][o]||o>=n.cols-1)&&(r[a].push({total:t.length,filled:e,blocks:t,found:s,isDone:!s.includes(!1)}),t=[],s=[])}g(r)},[C,l,d,n.rows,n.cols]),D=e.useCallback(()=>{if(!C)return;let e,t,s;const r=Array.from({length:n.cols},()=>[]);for(let a=0;a<n.cols;a++){t=[],s=[];for(let o=0;o<n.rows;o++)e=l[o][a],t.push(o),s.push(!(!1===d[o][a]||d.slice(0,o).map(e=>e[a]).includes(!1)&&d.slice(o+1).map(e=>e[a]).includes(!1))),(l[o+1]?.[a]!==l[o][a]||o>=n.rows-1)&&(r[a].push({total:t.length,filled:e,blocks:t,found:s,isDone:!s.includes(!1)}),t=[],s=[])}x(r)},[C,l,d,n.rows,n.cols]),R=e.useMemo(()=>({rows:m.map(e=>e.every(e=>!0===e.isDone)),cols:f.map(e=>e.every(e=>!0===e.isDone))}),[m,f]),P=e.useMemo(()=>M>=we.game.score.win,[M]);return e.useEffect(()=>b(),[b]),e.useEffect(()=>{$(),D()},[$,D]),e.useEffect(()=>(S&&_?a():S&&r(),()=>a()),[S,_,r,a]),t.jsx(Ue.Provider,{value:{isReady:C,isStarted:S,isCompleted:_,isDone:R,hasWin:P,grid:l,interactions:d,hints:{rows:m,cols:f},total:y,totalAvailable:v,totalFound:w,totalCorrect:j,totalErrors:N,totalInteractions:E,rating:M,score:I,init:b,setInteraction:L},children:s})}],We=({children:e})=>Ye.reduceRight((e,s)=>t.jsx(s,{children:e}),e),Ze=()=>{const{i18n:t}=l(),s=e.useCallback(e=>{try{return new Intl.NumberFormat(t.language,e)}catch(s){return new Intl.NumberFormat(we.locale.allowed.default,e)}},[t.language]);return{number:(e,t)=>s({style:"decimal",minimumFractionDigits:0,maximumFractionDigits:t??0}).format(e??0),percentage:(e,t)=>s({style:"percent",minimumFractionDigits:0,maximumFractionDigits:t??0}).format(e??0)}},Je=()=>{const{totalAvailable:s,totalFound:r}=Be(),{percentage:a}=Ze(),o=e.useMemo(()=>Math.round(100*r/s*100)/100,[s,r]),i=e.useMemo(()=>o>0&&o<100,[o]);return t.jsxs("div",{className:n(["progress-wrapper absolute top-0 left-0 right-0 overflow-hidden contain-layout z-10","transition-[height]",i?"h-[1rem]":"h-[0rem]"]),"aria-hidden":!0,children:[t.jsx("progress",{className:"progress progress-accent block bg-base-100 w-full h-full border-none rounded-none",value:r,max:s}),t.jsx("div",{className:n(["badge badge-xs badge-accent rounded-none font-black","absolute bottom-0 -translate-x-full","text-base-100","transition-[left,opacity] duration-150 will-change-transform",{"opacity-0":!i}]),style:{left:`${o}%`,contentVisibility:"auto"},children:a(o/100)})]})},Qe=()=>{const[s,n]=e.useState(null);return e.useEffect(()=>{(async()=>{const{renderToStaticMarkup:e}=await pe(async()=>{const{renderToStaticMarkup:e}=await import("./vendor-D_24E6d6.js").then(e=>e.s);return{renderToStaticMarkup:e}},__vite__mapDeps([1,2,3,4,5])),s=e(t.jsx(C,{size:24,color:Me("--color-primary")}));n(`data:image/svg+xml,${encodeURIComponent(s)}`)})()},[]),s?t.jsx("link",{rel:"icon",href:s}):null},et=()=>{const{i18n:s,t:n}=l(),{seed:r,rows:a,cols:o,difficulty:i}=Oe();return e.useEffect(()=>document.documentElement.setAttribute("lang",s.language),[s.language]),t.jsxs(t.Fragment,{children:[t.jsx("title",{children:`${n("title")} v${he} | ${o}x${a} ${n(`difficulties.${i}`)} - ${r}`}),t.jsx("meta",{name:"description",content:n("description",{title:n("title")})}),t.jsx(Qe,{}),we.preload.map((e,s)=>t.jsx("link",{rel:e.rel,href:e.href,crossOrigin:e.crossorigin},s)),we.meta.map((e,s)=>t.jsx("meta",{name:e.name,httpEquiv:e.httpEquiv,content:Array.isArray(e.content)?e.content.join("; "):e.content},s))]})},tt=()=>{const{seed:s,isRefreshing:n}=Oe(),[r,a]=e.useState(""),o=e.useRef(null),i=e.useMemo(()=>{const e=r||s;if(e.length<10)return[e];const t=[],n=Math.min(Math.round(e.length/10),5),a=Math.ceil(e.length/n);for(let s=0;s<e.length&&t.length<n;s+=a)t.push(e.slice(s,s+a));return t},[r,s]),l=e.useCallback(()=>a(Ee()),[]),c=()=>{null!==o.current&&(clearInterval(o.current),o.current=null)};return e.useEffect(()=>(c(),n?(l(),o.current=setInterval(l,100)):a(""),()=>c()),[n,l]),t.jsx("div",{className:"absolute inset-0 pointer-events-none overflow-hidden","aria-hidden":!0,children:t.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-1/2 w-[110%] max-h-[100vh] text-[16vw] font-black italic leading-[0.8em] tracking-tighter text-base-100 text-center",children:i.map((e,s)=>t.jsx("div",{className:"contain-layout w-full min-h-20 lg:min-h-35",children:e},s))})})},st=({size:e="md"})=>{const{t:s}=l();return t.jsxs("h1",{className:n(["block font-black text-primary align-middle","md"===e?"text-2xl max-w-[200px] leading-[0.9em]":"text-4xl max-w-[250px] leading-[0.85em]"]),children:[t.jsx(C,{className:"inline-block md:block w-[1em] h-[1em] scale-250 origin-[80%_50%] md:origin-center mr-5"}),t.jsxs("span",{className:"relative inline-block",children:[s("title"),t.jsxs("span",{className:"absolute top-0 left-0 -translate-1/2 badge badge-xs badge-accent",children:["v",he]})]})]})},nt=({className:s,children:r})=>{const a=e.useMemo(()=>r?e.Children.map(r,(t,s)=>e.isValidElement(t)?e.cloneElement(t,{isFirst:0===s}):t):null,[r]);return t.jsx("div",{className:n(["btn gap-0 items-stretch h-auto p-0 contain-layout",s]),"aria-hidden":!0,children:a})},rt=({title:s,subTitle:r,description:a,icon:o,isFirst:i,className:l})=>t.jsxs("div",{className:n(["flex flex-row gap-1 items-center","min-w-[75px] px-2 py-1 pointer-events-none",l,{"border-l-1 border-black/10":!i}]),children:[e.cloneElement(o,{className:"text-svg text-2xl"}),t.jsxs("span",{className:"flex flex-col items-start",children:[t.jsxs("span",{className:"text-xs leading-[1.2em]",children:[t.jsx("strong",{children:s}),r?t.jsxs("span",{className:"text-xxs leading-[1em]",children:["/",r]}):null]}),t.jsx("span",{className:"text-xxs leading-[1.2em]",children:a})]})]}),at=({difficulty:e,className:s=""})=>(s=n(["text-svg",s]),{easy:t.jsx(_,{className:s}),medium:t.jsx(I,{className:s}),hard:t.jsx(M,{className:s})}[e]),ot=()=>{const{t:e}=l(),{rows:s,cols:n,difficulty:r}=Oe(),{scale:a}=Te(),{percentage:o}=Ze();return t.jsxs(nt,{className:"btn-outline btn-primary",children:[t.jsx(rt,{title:`${n}×${s}`,description:e("grid"),icon:t.jsx(L,{})}),t.jsx(rt,{title:e(`difficulties.${r}`),description:e("difficulty"),icon:t.jsx(at,{difficulty:r})}),t.jsx(rt,{title:o(a),description:e("scale"),icon:t.jsx($,{})})]})},it=({timeUnits:s,onlyTimeUnits:r=[],forceTimeUnits:a=!1,leadingZero:o=!1,units:i="normal",separator:c="auto",blink:d=!1,className:u=""})=>{const{t:m}=l(),g=e.useMemo(()=>r.length>0?Object.keys(s).filter(e=>r.includes(e)):Object.keys(s),[s,r]);return g.length>0?t.jsx("div",{className:`counter ${u}`.trim(),children:g.map((r,l)=>{const u=s[r]??0;return a||"seconds"===r||u>0?t.jsx(e.Fragment,{children:t.jsxs("div",{className:n([`counter-${r}`,"text-nowrap"]),children:[t.jsx("span",{className:"counter-value",children:o?("0"+u).slice(-2):u}),!1!==i&&t.jsx("span",{className:"counter-label",children:"abbr"===i?m(`timeUnits.${r}`,{count:u}).toLowerCase().substring(0,1):` ${m(`timeUnits.${r}`,{count:u}).toLowerCase()}`}),!1!==c&&l<g.length-1?t.jsx("span",{className:n(["counter-separator",{"opacity-0":d}]),children:"auto"===c?"normal"===i&&l<g.length-2||"abbr"===i||!1===i?", ":"normal"===i?` ${m("and").toLowerCase()} `:null:c}):null]})},r):null})}):null},lt=()=>{const{showEffects:e}=Oe(),{timeUnits:s,blink:r}=qe(),{isStarted:a,isCompleted:o}=Be();return t.jsxs("div",{className:n(["btn",a||o?"btn-outline":"btn-dash text-primary/30 border-primary/30",o?"btn-accent":"btn-primary","flex flex-col gap-0 pointer-events-none h-auto px-2 py-1",{"transition-[scale,background-color,color,border-color,opacity] duration-500 ease-in-out":e,"scale-95":!r}]),children:[t.jsx(it,{timeUnits:s,onlyTimeUnits:["days","months","years"],separator:!1,className:"flex gap-x-1 text-xxs leading-[1.5em]"}),t.jsx(it,{timeUnits:s,onlyTimeUnits:["seconds","minutes","hours"],forceTimeUnits:!0,leadingZero:!0,units:!1,separator:":",blink:r,className:"flex text-xl font-mono leading-[1.1em]"})]})},ct=({name:e,country:s=null,variant:a="marble",className:o=""})=>t.jsxs("div",{className:n(["avatar relative",o]),children:[t.jsx(r,{name:`${e||""}${s||""}`,variant:a,colors:[Me("--color-primary"),Me("--color-secondary"),Me("--color-accent"),Me("--color-info"),Me("--color-warning")],className:"w-full"}),s?t.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-1/2 badge badge-outline badge-xs !border-base-200 !text-base-200 px-1 rounded-full text-xxs font-black",children:s}):null]}),dt=()=>{const{t:s}=l(),{user:r,country:a,showEffects:o,setIsDrawerShown:i}=Oe(),{play:c}=He(),[d,u]=e.useState(!1);return t.jsxs("button",{type:"button",className:"btn btn-lg btn-outline btn-accent hover:btn-primary text-primary hover:text-accent rounded-full p-1 sm:pe-5 h-auto font-normal max-w-[150px]",onPointerEnter:()=>{c("grid-block-over"),u(!0)},"aria-label":s("settings"),onPointerLeave:()=>u(!1),onClick:()=>i(!0),children:[t.jsxs("div",{className:"bg-accent w-[3rem] sm:w-[2.5rem] aspect-square rounded-full overflow-hidden relative",children:[t.jsx(ct,{name:r,country:a,className:n({"transition-opacity duration-300":o,"opacity-0":d})}),t.jsx(D,{className:n(["text-svg absolute top-1/2 left-1/2 -translate-1/2","text-3xl sm:text-2xl text-primary",{"transition-[opacity,scale] duration-300":o,"opacity-0 scale-150":!d}])})]}),t.jsxs("div",{className:"hidden sm:flex flex-col flex-1 min-w-0 text-xs text-start leading-[1em]",children:[t.jsx("div",{className:"font-bold",children:s("user")}),t.jsx("div",{className:"overflow-hidden text-ellipsis whitespace-nowrap",children:r})]})]})},ut=()=>{const{t:e}=l(),{number:s}=Ze(),{showEffects:r}=Oe(),{total:a,totalAvailable:o,totalInteractions:i,totalFound:c,totalErrors:d}=Be();return t.jsxs(nt,{className:"btn-outline btn-primary",children:[t.jsx(rt,{title:s(o-c),subTitle:s(a-i),description:t.jsxs(t.Fragment,{children:[t.jsx("strong",{children:e("status.available")}),"/",e("status.total")]}),icon:t.jsx(R,{}),className:"text-primary"}),t.jsx(rt,{title:s(c),description:e("status.found"),icon:t.jsx(P,{}),className:n(["bg-accent/10",c>0?"text-accent":"text-accent/20",{"transition-[color] duration-500":r}])}),t.jsx(rt,{title:s(d),description:e("status.errors"),icon:t.jsx(O,{}),className:n(["bg-error/10",d>0?"text-error":"text-error/20",{"transition-[color] duration-500":r}])})]})},mt=()=>{const{t:s}=l(),{isRefreshing:r,setSeed:a,showEffects:o}=Oe(),{play:i}=He(),[c,d]=e.useState(!1);return t.jsx("button",{type:"button",className:n(["btn btn-sm btn-outline btn-circle",c?"!bg-secondary text-white":"btn-accent"]),"aria-label":s("refresh"),disabled:r||c,onPointerEnter:()=>i("grid-block-over"),onClick:()=>{r||c||(a(),o&&d(!0))},children:t.jsx(A,{className:n(["text-svg text-xl pointer-events-none",{"duration-500":o,"transition-[rotate] -rotate-360":o&&(r||c),"transition-none rotate-0":!r&&!c}]),onTransitionEnd:()=>d(!1)})})},gt=()=>{const{t:s}=l(),{isInteracting:r,setIsInteracting:a}=Fe(),{isScaling:o}=Te(),{isAuto:i,showEffects:c,isDrawerShown:d,setIsAuto:u}=Oe(),{play:m}=He(),[g,f]=e.useState(!1),p=e.useRef(!1),x=e.useCallback(e=>{"Space"===e.code&&(p.current||(p.current=!0,u(!1),f(e=>!e)),e.preventDefault())},[u]),h=e=>{"Space"===e.code&&(p.current=!1)};return e.useEffect(()=>{i||a(g?"right":"left")},[i,g,a]),e.useEffect(()=>{i&&f("right"===r)},[i,g,r]),e.useEffect(()=>m("grid-block-correct"),[g,m]),e.useEffect(()=>(d||(window.addEventListener("keydown",x),window.addEventListener("keyup",h)),()=>{window.removeEventListener("keydown",x),window.removeEventListener("keyup",h)})),t.jsxs("div",{className:"flex flex-col gap-1 items-center",children:[t.jsxs("kbd",{className:"kbd kbd-xs hidden lg:block",children:[t.jsx(T,{className:"text-svg me-1"})," spacebar"]}),t.jsxs("label",{className:n(["indicator indicator-middle indicator-center outline-2 pointer-events-auto","flex gap-4 items-center justify-center contain-layout",g?"bg-primary":"bg-accent","rounded-full text-xl py-1 px-6",{"outline-secondary pointer-events-none":i,"cursor-pointer":!i,"outline-primary/0 hover:outline-primary":!i&&!g,"outline-accent/0 hover:outline-accent":!i&&g,"inset-shadow-sm inset-shadow-black/20":c,"transition-[background-color,outline-color,opacity] duration-300":c,"opacity-30":o}]),onPointerEnter:()=>m("grid-block-over"),children:[t.jsx("span",{className:n(["pointer-events-none will-change-transform",g?"text-white/30 scale-100":"text-white scale-140",{"drop-shadow":c,"transition-transform duration-300":c}]),children:t.jsx(P,{className:"text-svg block"})}),t.jsx("input",{type:"checkbox",className:n(["pointer-events-none toggle toggle-xl toggle-white","bg-white border-white text-accent","checked:bg-white checked:border-white checked:text-primary",{"shadow-lg shadow-black/20":c}]),checked:g,onChange:()=>f(e=>!e)}),t.jsx("span",{className:n(["pointer-events-none will-change-transform",g?"text-white scale-140":"text-white/50 scale-100",{"drop-shadow":c,"transition-transform duration-300":c}]),children:t.jsx(F,{className:"text-svg block"})}),t.jsxs("div",{className:n(["pointer-events-none indicator-item badge badge-secondary rounded-full gap-1","font-bold uppercase",i?"bg-secondary/80 backdrop-blur-sm":"opacity-0"]),children:[t.jsx(U,{className:"text-svg"}),s("autoShort")]})]})]})},ft=()=>{const{isMusicOn:e,showEffects:s,isAuto:n,showIntersections:r,isLeaderboardOn:a}=Oe();return t.jsxs("div",{className:"flex flex-col gap-1.5 px-1.5 py-3 bg-base-200/50 text-svg text-sm text-base-content/30 rounded-full backdrop-blur-xs",children:[e?t.jsx(z,{className:"text-secondary"}):t.jsx(q,{}),s?t.jsx(B,{className:"text-secondary"}):t.jsx(V,{}),n?t.jsx(U,{className:"text-secondary"}):t.jsx(G,{}),r?t.jsx(K,{className:"text-secondary"}):t.jsx(X,{}),a?t.jsx(H,{className:"text-secondary"}):t.jsx(Y,{})]})},pt=e.memo(()=>t.jsx("header",{className:"flex absolute inset-0 pointer-events-none contain-layout",children:t.jsxs("div",{className:"p-5 md:p-10 flex flex-1 flex-col gap-1 justify-between",children:[t.jsxs("div",{className:"flex flex-row gap-1 justify-between flex-wrap sm:flex-nowrap relative",children:[t.jsx("div",{className:"sm:min-w-1/3",children:t.jsx(st,{})}),t.jsx("div",{className:"order-last sm:order-none w-full flex justify-center self-center",children:t.jsx(lt,{})}),t.jsxs("div",{className:"flex gap-1 sm:min-w-1/3 sm:justify-end items-center self-center",children:[t.jsx(mt,{}),t.jsx(dt,{})]})]}),t.jsx("div",{className:"flex flex-row gap-1 justify-between",children:t.jsx(ft,{})}),t.jsxs("div",{className:"min-h-[1rem] flex flex-col md:flex-row gap-1 md:justify-between items-center md:items-end flex-wrap lg:flex-nowrap",children:[t.jsx("div",{className:"lg:min-w-1/3",children:t.jsx(ut,{})}),t.jsx("div",{className:"order-first mb-5 lg:mb-0 lg:order-none w-full flex justify-center",children:t.jsx(gt,{})}),t.jsx("div",{className:"lg:min-w-1/3 md:flex md:justify-end",children:t.jsx(ot,{})})]})]})})),xt=({mountIf:t,timeout:s,className:r="",unmountOnExit:a=!0,onMounted:o,onEntering:i,onDone:l,onExiting:c,onUnmounted:d,children:u})=>{const[m,g]=e.useState(t),[f,p]=e.useState("idle"),x=e.useRef(null),h=e.useRef(null),b=e.useRef(null),y=e.useRef(null),v=e.useMemo(()=>"object"==typeof s&&s.delay?s.delay:0,[s]),w=e.useMemo(()=>"object"==typeof s?s.entering??0:s,[s]),j=e.useMemo(()=>"object"==typeof s?s.exiting??0:s,[s]),k=e.useMemo(()=>w>0?"object"==typeof s&&s.start&&s.start>=50?s.start:50:0,[s,w]),N=e.useMemo(()=>["entering","done"].includes(f),[f]),E=e.useMemo(()=>["mounted","entering"].includes(f),[f]),S=()=>{[x,h,b,y].forEach(e=>{null!==e.current&&(clearTimeout(e.current),e.current=null)})};if(e.useEffect(()=>(S(),t?x.current=setTimeout(()=>{g(!0),p("mounted"),h.current=setTimeout(()=>{p("entering"),b.current=setTimeout(()=>p("done"),w)},k)},v):(p("exiting"),y.current=setTimeout(()=>p("unmounted"),j)),()=>S()),[t,v,k,w,j,a]),e.useEffect(()=>{switch(f){case"mounted":o&&o();break;case"entering":i&&i();break;case"done":l&&l();break;case"exiting":c&&c();break;case"unmounted":d&&d(),a&&g(!1),p("idle")}},[f,o,i,l,c,d,a]),!m)return null;return u({className:n([`mount-transition-${f}`,{[`mount-transition ${r}`]:N}]),status:f,isEntering:N,isMounting:E})},ht=()=>{const{showEffects:e}=Oe(),{isInteracting:s}=Fe();return t.jsx(xt,{mountIf:"right"===s,timeout:e?400:0,children:({isEntering:s})=>t.jsx("div",{className:n(["absolute inset-0 pointer-events-none overflow-hidden",s?"bg-base-200/50":"bg-base-200/0",{"transition-[background-color] duration-400":e}]),"aria-hidden":!0,children:t.jsx("p",{className:n(["absolute top-1/2 left-1/2 -translate-1/2 text-[250vw] leading-[0.8em] text-base-200",s?"opacity-100 scale-100":"opacity-0 scale-150",{"transition-[opacity,scale] duration-400":e}]),children:t.jsx(F,{className:"text-svg"})})})})},bt=()=>{(()=>{const{i18n:t}=l(),s=v(),n=w(),{logEvent:r}=ye(),a=j(),{rows:o,cols:i,difficulty:c,seed:d,setRows:u,setCols:m,setDifficulty:g,setSeed:f}=Oe(),p=e.useRef(!1),x=e.useMemo(()=>a.pathname.split("/")[2]??we.pages.default,[a.pathname]),h=e.useMemo(()=>"string"==typeof t.options.fallbackLng?t.options.fallbackLng:we.locale.allowed.default,[t.options.fallbackLng]),b=e.useMemo(()=>s.language&&h&&!Object.keys(t.options.resources??{}).includes(s.language)?h:s.language&&t.language!==s.language?t.language:we.locale.allowed.default,[t.options.resources,t.language,s.language,h]),y=e.useCallback((e,t)=>Number.isNaN(t)||t===e?e:t>=we.game.grid.min&&t<=we.game.grid.max?t:we.game.grid.default,[]),k=e.useMemo(()=>Object.keys(we.game.difficulty.list).includes(s.difficulty)?s.difficulty!==c?s.difficulty:c:we.game.difficulty.default,[s.difficulty,c]),N=e.useMemo(()=>s.seed||d,[s.seed,d]),E=e.useCallback(()=>{if(!p.current&&(t.changeLanguage(b),x===we.pages.default)){const e=y(o,Number(s.rows)),t=y(i,Number(s.cols));o!==e&&u(e),i!==t&&m(t),c!==k&&g(k),d!==N&&f(N)}},[t,x,b,y,k,N,s.rows,s.cols,o,i,c,d,u,m,g,f]),S=e.useCallback(()=>{p.current=!0,x===we.pages.default?n(`/${t.language}/${x}/${i}/${o}/${c}/${d}`,{replace:!1}):n(`/${t.language}/${x}`,{replace:!0})},[n,x,t.language,i,o,c,d]);e.useEffect(()=>{r("page_view",{page_location:window.location.href,page_path:a.pathname,page_title:document.title})},[r,a.pathname]),e.useEffect(E,[E]),e.useEffect(S,[S])})();const{showEffects:s}=Oe();return t.jsxs("main",{className:"flex flex-1 relative",children:[s?t.jsx(tt,{}):null,t.jsx(ht,{}),t.jsx(k,{}),t.jsx(pt,{})]})},yt=e=>Math.round(Math.max(0,Math.min(255,e))),vt=e=>{let t=0,s=0,n=0;if((e=>/^oklch\(([\d.]+)%?\s+([\d.]+)\s+([\d.]+)\)$/.test(e))(e)){const r=e.match(/^oklch\(([\d.]+)%?\s+([\d.]+)\s+([\d.]+)\)$/);if(r&&r[1]&&r[2]&&r[3]){let a=parseFloat(r[1]);const o=parseFloat(r[2]),i=parseFloat(r[3]);e.includes("%")&&(a/=100);const l=x({mode:"oklch",l:a,c:o,h:i}),c=h(l);c&&(t=255*c.r,s=255*c.g,n=255*c.b)}}else if((e=>/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/.test(e))(e)){const r=e.match(/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/);r&&(t=Number(r[1]),s=Number(r[2]),n=Number(r[3]))}else if((e=>/^#[0-9A-Fa-f]{3,6}$/.test(e))(e)){const r=h(e);r&&(t=255*r.r,s=255*r.g,n=255*r.b)}return[yt(t),yt(s),yt(n)]},wt=({isOver:e})=>{const{showEffects:s}=Oe();return t.jsx(xt,{mountIf:e,timeout:s?{entering:150,exiting:600}:0,children:({isEntering:e,isMounting:r})=>t.jsx("div",{className:n(["game-grid-block-void","absolute inset-0 pointer-events-none","bg-primary",e?"opacity-100 scale-100":"opacity-0 scale-80",{"transition-[opacity,scale]":s,"duration-150":s&&r,"duration-600":s&&!r}])})})},jt=({hasInteracted:s,isError:r})=>{const{showEffects:a}=Oe(),{isCompleted:o}=Be(),i=e.useMemo(()=>a&&!1!==s&&Math.random()<.1,[a,s]),l=e.useMemo(()=>i?Math.round(5*Math.random()*100)/100:0,[i]);return t.jsx(xt,{mountIf:!1!==s||!1===s&&o,timeout:a?200:0,children:({isEntering:e})=>t.jsx("div",{className:n(["game-grid-block-empty","absolute inset-0 pointer-events-none","bg-base-200 text-sm",e?"opacity-100 scale-100":"opacity-0 scale-10",{"game-grid-block-empty-glitch":i,"game-grid-block-empty-error":r,"transition-[opacity,scale] duration-200":a}]),style:{"--glitch-delay":`${l}s`}})})},kt=({isTarget:e})=>{const{showIntersections:s}=Oe();if(s)return t.jsx("div",{className:n(["absolute inset-0 pointer-events-none",{"bg-secondary/10":!e,"border-2 border-secondary":e}])})},Nt=({hasInteracted:s,isFilled:r,isError:a,isOver:o})=>{const{showEffects:i}=Oe(),{isCompleted:l}=Be(),c=e.useRef(null);return t.jsx(xt,{mountIf:!r&&!1!==s||l&&!1===s,timeout:i?400:0,children:({isEntering:e})=>t.jsx("div",{ref:c,className:n(["grid-block-icon","absolute inset-0 pointer-events-none","flex items-center justify-center",e?"opacity-100 scale-100":"opacity-0 scale-1",a?"text-error":!l&&o&&!1===s?"text-base-content":"text-primary",{"transition-[opacity,scale] duration-400":i}]),children:t.jsx("div",{className:"align-middle leading-1 relative -top-[0.07em] font-black",children:"×"})})})},Et=()=>{const{isCompleted:e}=Be(),{showEffects:s}=Oe();return t.jsx("div",{className:n(["game-grid-block-filled-perfect","absolute inset-0 pointer-events-none scale-500",{"transition-opacity duration-500":s,"opacity-0":!e}])})},St=()=>{const s=e.useRef(Math.round(5*Math.random()*100)/100);return t.jsx("div",{className:"game-grid-block-filled-shining absolute inset-0 pointer-events-none scale-500 mix-blend-overlay opacity-70",style:{"--shining-delay":`${s.current}s`}})},Ct=({hasInteracted:s,isError:r})=>{const{totalErrors:a}=Be(),{showEffects:o}=Oe(),i=e.useMemo(()=>o&&"left"===s&&Math.random()<.3,[o,s]),l=e.useMemo(()=>o&&!1!==s&&Math.random()<.4,[o,s]),c=e.useMemo(()=>l?Math.round(.5*Math.random()*100)/100:0,[l]);return t.jsx(xt,{mountIf:!1!==s,timeout:o?200:0,children:({isEntering:e})=>t.jsxs("div",{className:n("game-grid-block-filled","absolute inset-0 text-sm pointer-events-none",e?"opacity-100 scale-100":"opacity-0 scale-10",{"transition-[opacity,scale] duration-200":o,"bg-accent":!r,"bg-error":r,"game-grid-block-filled-random":c>0}),style:{"--filled-random-opacity":c},children:[!1===s||0!==a||r?null:t.jsx(Et,{}),i?t.jsx(St,{}):null]})})},Mt=({mountIf:s,delay:r})=>{const[a,o]=e.useState(!0);return t.jsx(xt,{mountIf:s&&a,timeout:{delay:r,entering:1e3,exiting:0},onDone:()=>o(!1),children:()=>t.jsx("div",{className:n(["game-grid-block-done","absolute inset-0 pointer-events-none","bg-white/80"])})})},It=({row:s,col:r})=>{const{grid:a,setInteraction:o,interactions:i,isCompleted:l,isReady:c,isDone:d}=Be(),{isRefreshing:u,isGlobalError:m,rows:g,cols:f,setIsGlobalError:p,showIntersections:x,showEffects:h}=Oe(),{isClicked:b,isInteracting:y,overCol:v,overRow:w}=Fe(),{play:j}=He(),[k,N]=e.useState(!1),E=e.useMemo(()=>v===r&&w===s,[v,w,r,s]),S=e.useMemo(()=>!(!c||!a[s][r])&&a[s][r],[c,a,s,r]),C=e.useMemo(()=>c&&i[s][r],[c,i,s,r]),M=e.useMemo(()=>c&&("left"===C&&!S||"right"===C&&S),[c,C,S]),I=e.useMemo(()=>h&&!1===C&&Math.random()<.3,[h,C]),_=e.useMemo(()=>h&&!1===C&&!u?Math.random()<.15:0,[h,C,u]),L=e.useMemo(()=>I?Math.round(.4*Math.random()*100)/100:0,[I]),$=e.useMemo(()=>_?Math.round(.9*Math.random()*100)/100:0,[_]),D=e.useMemo(()=>l||m||!1!==C,[l,m,C]);return e.useEffect(()=>{!D&&E&&b&&o({row:s,col:r,hasInteracted:y})},[s,r,o,D,E,b,y,M]),e.useEffect(()=>(M&&p(!0),()=>p(!1)),[M,p]),e.useEffect(()=>{D||!E||b||j("grid-block-over")},[D,E,b,j]),e.useEffect(()=>{k||!1===C||(j(M?"grid-block-wrong":"grid-block-correct"),N(!0))},[k,C,M,j]),t.jsx("div",{role:"button",className:n(["game-grid-block","relative aspect-square overflow-hidden",{"game-grid-block-t-strong":s%5==0,"game-grid-block-l-strong":r%5==0,"game-grid-block-b-strong":s>=g-1,"game-grid-block-r-strong":r>=f-1,"game-grid-block-glitching":_,"transition-[background-color] duration-100":h&&_,"cursor-pointer":!D}]),"data-row":s,"data-col":r,style:{"--block-random-opacity":I?L:null,"--glitching-delay":_?`${$}s`:null},children:u?null:t.jsxs(t.Fragment,{children:[l?null:t.jsx(wt,{isOver:!D&&E}),S?t.jsx(Ct,{hasInteracted:C,isError:M}):t.jsx(jt,{hasInteracted:C,isError:M}),t.jsx(Nt,{hasInteracted:C,isFilled:S,isError:M,isOver:!D&&E}),h?t.jsxs(t.Fragment,{children:[t.jsx(Mt,{mountIf:d.cols[r],delay:100*s}),t.jsx(Mt,{mountIf:d.rows[s],delay:100*r})]}):null,!x||l||v!==r&&w!==s?null:t.jsx(kt,{isTarget:E})]})})},_t=({total:e,isDone:s})=>{const{showEffects:r}=Oe();return t.jsx("span",{className:n(["min-w-[1.3em] h-[1.3em] leading-[1.3em] text-center",{"transition-[color] duration-200":r,"text-accent":s,"text-primary font-bold":!s}]),children:e})},Lt=({type:e,hints:s,isLineDone:r})=>{const{isRefreshing:a,showEffects:o}=Oe();return s?t.jsx("div",{className:n(["game-grid-hint-group","flex flex-grow items-center justify-end","col"===e?"game-grid-hint-group-col flex-col":"game-grid-hint-group-row flex-row",{"transition-[background-color] duration-400":o,"bg-accent/25":r}]),children:a?null:s.map((e,s)=>e.filled?t.jsx(_t,{total:e.total,isDone:r||e.isDone},s):null)}):null},$t=()=>{const{cols:e,rows:s}=Oe();return t.jsx("div",{className:"game-grid-hint-size flex flex-1 items-end justify-end font-bold text-white leading-[1.3em]",children:t.jsxs("div",{className:"flex items-end group pointer-events-auto",children:[t.jsxs("div",{className:"relative",children:[t.jsx("span",{className:"transition-[opacity,filter] duration-500 group-hover:opacity-80 group-hover:blur-[0.2rem]",children:e}),t.jsx(W,{className:"text-svg absolute top-1/2 left-1/2 -translate-1/2 text-primary opacity-0 transition-opacity duration-200 group-hover:opacity-100"})]}),t.jsx("div",{children:"×"}),t.jsxs("div",{className:"relative",children:[t.jsx("span",{className:"transition-[opacity,filter] duration-500 group-hover:opacity-80 group-hover:blur-[0.2rem]",children:s}),t.jsx(Z,{className:"text-svg absolute top-1/2 left-1/2 -translate-1/2 text-primary opacity-0 transition-opacity duration-200 group-hover:opacity-100"})]})]})})},Dt=({row:e,col:s})=>{const{hints:r,isCompleted:a,isDone:o}=Be(),{rows:i,cols:l,showIntersections:c}=Oe(),{overCol:d,overRow:u}=Fe();return t.jsxs("div",{className:n(["game-grid-hint","flex relative pointer-events-none",e>=0||s>=0?"bg-base-200/50":"bg-accent",{"game-grid-hint-t-strong":e%5==0||-1===e,"game-grid-hint-l-strong":s%5==0||-1===s,"game-grid-hint-b-strong":e>=i-1||-1===e,"game-grid-hint-r-strong":s>=l-1||-1===s}]),children:[e>=0||s>=0?t.jsxs(t.Fragment,{children:[s<0&&r.rows[e]?t.jsx(Lt,{type:"row",hints:r.rows[e],isLineDone:o.rows[e]}):null,e<0&&r.cols[s]?t.jsx(Lt,{type:"col",hints:r.cols[s],isLineDone:o.cols[s]}):null]}):t.jsx($t,{}),!c||a||d!==s&&u!==e?null:t.jsx(kt,{})]})},Rt=e.memo(()=>{const{isInteracting:s}=Fe(),{isCompleted:r}=Be(),{showEffects:a,isRefreshing:o,isGlobalError:i,rows:l,cols:c,difficulty:d,seed:u}=Oe(),{play:m}=He(),[g,f]=e.useState(""),p={5:"grid-cols-[min-content_repeat(5,1fr)]",6:"grid-cols-[min-content_repeat(6,1fr)]",7:"grid-cols-[min-content_repeat(7,1fr)]",8:"grid-cols-[min-content_repeat(8,1fr)]",9:"grid-cols-[min-content_repeat(9,1fr)]",10:"grid-cols-[min-content_repeat(10,1fr)]",11:"grid-cols-[min-content_repeat(11,1fr)]",12:"grid-cols-[min-content_repeat(12,1fr)]",13:"grid-cols-[min-content_repeat(13,1fr)]",14:"grid-cols-[min-content_repeat(14,1fr)]",15:"grid-cols-[min-content_repeat(15,1fr)]",16:"grid-cols-[min-content_repeat(16,1fr)]",17:"grid-cols-[min-content_repeat(17,1fr)]",18:"grid-cols-[min-content_repeat(18,1fr)]",19:"grid-cols-[min-content_repeat(19,1fr)]",20:"grid-cols-[min-content_repeat(20,1fr)]"},x={5:"grid-rows-[min-content_repeat(5,1fr)]",6:"grid-rows-[min-content_repeat(6,1fr)]",7:"grid-rows-[min-content_repeat(7,1fr)]",8:"grid-rows-[min-content_repeat(8,1fr)]",9:"grid-rows-[min-content_repeat(9,1fr)]",10:"grid-rows-[min-content_repeat(10,1fr)]",11:"grid-rows-[min-content_repeat(11,1fr)]",12:"grid-rows-[min-content_repeat(12,1fr)]",13:"grid-rows-[min-content_repeat(13,1fr)]",14:"grid-rows-[min-content_repeat(14,1fr)]",15:"grid-rows-[min-content_repeat(15,1fr)]",16:"grid-rows-[min-content_repeat(16,1fr)]",17:"grid-rows-[min-content_repeat(17,1fr)]",18:"grid-rows-[min-content_repeat(18,1fr)]",19:"grid-rows-[min-content_repeat(19,1fr)]",20:"grid-rows-[min-content_repeat(20,1fr)]"};return e.useEffect(()=>{o&&m("grid-refresh")},[o,m]),t.jsx(xt,{mountIf:!r&&!o,timeout:{start:100,entering:300,exiting:r?1700:300},onMounted:()=>f(`${u}.${l}x${c}.${d}`),children:({isEntering:d})=>t.jsx("div",{className:n(["game-grid",{"game-grid-error":i,"game-grid-right":!i&&"right"===s},"flex flex-col grow justify-center items-center my-auto relative"]),style:{"--block-color":`${vt(Me("--color-white"))}`},children:t.jsx("div",{className:n(["game-grid-wrapper grid",p[c],x[l],"p-0.5 min-w-fit min-h-fit h-full max-w-full max-h-full","border-5 rounded-lg",i?"border-error":"left"===s?"border-accent":"border-primary",d?"opacity-100 scale-100":r?"scale-50 opacity-0":"scale-90 opacity-0",a?"transition-[opacity,filter,scale,border-color,box-shadow]":"transition-[opacity,scale,border-color]",r?"duration-1200 ease-in delay-500":"duration-300 ease-out",{"blur-md":a&&r,"blur-xs":a&&!r&&o}]),children:Array.from({length:l+1}).map((s,n)=>Array.from({length:c+1}).map((s,r)=>t.jsx(e.Fragment,{children:0===n||0===r?t.jsx(Dt,{row:n-1,col:r-1}):t.jsx(It,{row:n-1,col:r-1})},`${n}.${r}`)))})},g)})}),Pt=t=>{const{firestore:s,isAuthenticated:n}=ye(),[r,a]=e.useState([]),[o,i]=e.useState(!0),[l,c]=e.useState(null),d=e.useMemo(()=>s?{firestore:s,collectionName:t}:null,[s,t]),u=e.useCallback(async(e=[])=>{if(n&&d){i(!0),c(null);try{const{collection:t,getDocs:s,query:n}=await pe(async()=>{const{collection:e,getDocs:t,query:s}=await import("./firestore-DfuMpQeo.js");return{collection:e,getDocs:t,query:s}},__vite__mapDeps([6,0,1,2,3,4,5])),r=n(t(d.firestore,d.collectionName),...e),o=await s(r);a(o.docs.map(e=>({id:e.id,...e.data()})))}catch(t){c(t instanceof Error?t.message:String(t))}finally{i(!1)}}},[n,d]),m=e.useCallback(async e=>{if(n&&d){i(!0),c(null);try{const{collection:t,addDoc:s}=await pe(async()=>{const{collection:e,addDoc:t}=await import("./firestore-DfuMpQeo.js");return{collection:e,addDoc:t}},__vite__mapDeps([6,0,1,2,3,4,5])),n=t(d.firestore,d.collectionName);await s(n,e),await u()}catch(t){c(t instanceof Error?t.message:String(t))}finally{i(!1)}}},[n,d,u]);return{docs:r,isLoading:o,error:l,getDocuments:u,addDocument:m}},Ot=()=>{const{t:s}=l(),{timeUnits:n}=qe(),r=e.useRef(n);return t.jsxs("div",{className:"badge badge-lg badge-light rounded-sm",children:[t.jsx(J,{className:"text-svg"}),s("score.time"),":",t.jsx(it,{timeUnits:r.current,units:"abbr",separator:!1,className:"flex gap-1 font-black text-secondary"})]})},At=()=>{const{t:s}=l(),{score:n}=Be(),{number:r}=Ze(),a=e.useRef(n);return t.jsxs("div",{className:"badge badge-lg badge-light rounded-sm",children:[t.jsx(Q,{className:"text-svg"}),s("score.points"),":",t.jsx("span",{className:"font-black text-secondary",children:r(a.current)})]})},Tt=({className:e=""})=>new Array(3).fill(0).map((s,r)=>t.jsx(ee,{className:n(["text-svg",e])},r)),Ft=({rating:s,hasTransition:r=!0,stroke:a="stroke-primary",fill:o="fill-primary",className:i=""})=>{const[l,c]=e.useState(0),[d,u]=e.useState(0),m=e.useRef(s),g=e.useRef(null),f=()=>{null!==g.current&&(clearTimeout(g.current),g.current=null)};return e.useEffect(()=>(f(),r?(u(100*s/70),g.current=setTimeout(()=>c(Math.round(100*m.current)),1e3)):c(Math.round(100*m.current)),()=>f()),[s,r]),t.jsxs("div",{className:n(["relative",i]),children:[t.jsx("div",{className:"flex flex-nowrap gap-0.2",children:t.jsx(Tt,{className:n([a])})}),t.jsx("div",{className:n(["flex flex-nowrap gap-0.2","absolute top-0 left-0 overflow-hidden",{"transition-[width] ease-out":r}]),style:{width:`${l}%`,transitionDuration:`${d}s`},children:t.jsx(Tt,{className:n(["flex-shrink-0",a,o])})})]})},Ut=()=>{const{rating:s,hasWin:r}=Be(),{percentage:a}=Ze(),o=e.useRef(s);return t.jsxs("div",{className:"indicator indicator-bottom indicator-center relative",children:[t.jsx("div",{className:n({"animate-bounce":r}),style:{filter:`drop-shadow(0 0 1.5rem rgba(${vt(Me("--color-white"))}, 0.8)`},children:t.jsx(Ft,{rating:s,stroke:"stroke-1 stroke-secondary",fill:"fill-secondary",className:"text-6xl"})}),t.jsxs("div",{className:"indicator-item badge badge-xl bg-white text-secondary border-none rounded-full shadow",children:[t.jsx(te,{className:"text-svg"}),t.jsx("span",{className:"font-black",children:a(o.current,1)})]})]})},zt=()=>{const{t:s}=l(),{logEvent:r}=ye(),{addDocument:a}=Pt("leaderboard"),{isReady:o,isCompleted:i,score:c,rating:d,hasWin:u}=Be(),{setSeed:m,user:g,country:f,seed:p,cols:x,rows:h,difficulty:b,showEffects:y,isLeaderboardOn:v}=Oe(),{ms:w}=qe(),{play:j}=He(),[k,N]=e.useState(""),[E,S]=e.useState(""),C=e.useCallback(e=>{const t=s(e,{returnObjects:!0});return t.length>0?t[Math.floor(Math.random()*t.length)]:""},[s]),M=e.useCallback(()=>{N(C("score.titles")),S(C("score.next")),j(u?"ending-victory":"ending-loss"),v&&u&&a({date:ce(),name:g??"",country:f,score:c,rating:d,cols:x,rows:h,difficulty:b,seed:p,time:w,prod:!0}),r("level_complete",{user:g,score:c,rating:d,cols:x,rows:h,difficulty:b,seed:p,time:w,prod:!0,has_win:u})},[r,C,j,v,a,u,g,f,c,d,x,h,b,p,w]);return t.jsx(xt,{mountIf:o&&i,timeout:y?{delay:1e3,entering:400,exiting:400}:0,onMounted:M,children:({isEntering:e,isMounting:s,status:r})=>t.jsx("div",{className:n(["overlay overflow-hidden","fixed inset-0 z-10","flex justify-center items-center",e?"opacity-100":"opacity-0",{"transition-opacity duration-400":y,"pointer-events-none":"done"!==r}]),children:t.jsxs("div",{className:"flex flex-col gap-10 text-white text-center",children:[t.jsx("div",{className:n(["text-[12vw] tracking-tight leading-[0.8em] font-black","done"!==r?s?"-translate-x-full opacity-0":"translate-x-full opacity-0":"translate-x-0 opacity-100",{"transition-[translate,opacity] duration-1000 drop-shadow-xl":y}]),children:k}),t.jsx("div",{className:"flex justify-center my-5",children:t.jsx(Ut,{})}),t.jsxs("div",{className:"flex flex-col items-center gap-0.5",children:[t.jsx(Ot,{}),t.jsx(At,{})]}),t.jsx("div",{children:t.jsxs("button",{type:"button",className:"btn btn-xl btn-secondary rounded-full px-15",disabled:!i,"aria-label":E,onClick:()=>m(),children:[t.jsx(se,{className:"text-svg"})," ",E]})})]})})})},qt=()=>t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"flex absolute inset-0 scrollbar overflow-auto",children:t.jsx(Rt,{})}),t.jsx(zt,{})]}),Bt=()=>{const{i18n:e}=l();return t.jsx(N,{children:t.jsxs(E,{element:t.jsx(bt,{}),children:[t.jsx(E,{path:"/:language/game/:cols/:rows/:difficulty/:seed",index:!0,element:t.jsx(qt,{})}),t.jsx(E,{path:"*",element:t.jsx(S,{to:`/${e.language}/${we.pages.default}`,replace:!0})})]})})},Vt=({show:e,label:s,children:r})=>{const{showEffects:a}=Oe();return t.jsxs("div",{className:n(["relative text-primary bg-white p-5 md:p-10 inline-block","rounded-lg shadow-lg shadow-primary/20",{"transition-[margin-right] duration-300":a,"-me-10 md:-me-25":e}]),children:[r,s?t.jsx("div",{className:"absolute left-5 md:left-10 top-0 -translate-y-1/2 badge badge-secondary",children:s}):null]})},Gt=({country:s,className:r})=>{const{isoToCountry:a}=(()=>{const{i18n:t}=l(),s=e.useCallback(e=>{try{return new Intl.DisplayNames(t.language,{type:e})}catch(s){}return new Intl.DisplayNames(we.locale.allowed.default,{type:e})},[t.language]),n=e.useCallback((e,t)=>{try{return(e&&s(t).of(e))??null}catch(n){}return null},[s]);return{isoToCountry:e.useCallback(e=>n(e,"region"),[n]),isoToLanguage:e.useCallback(e=>n(e,"language"),[n])}})(),[o,i]=e.useState(null);return e.useEffect(()=>{s&&i(a(s))},[a,s]),o?t.jsx("span",{className:n(r),children:o}):null},Kt=()=>{const{t:e}=l(),{user:s,country:n,setUser:r}=Oe(),{play:a}=He();return t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(ct,{name:s,country:n,className:"max-w-[4rem]"}),t.jsxs("label",{className:"input input-primary w-full",children:[t.jsx("strong",{className:"text-accent",children:e("user")}),t.jsx("input",{type:"text",value:s||"",onChange:e=>{a("grid-block-over"),r(e.target.value.trim().length>0?e.target.value:"")},onBlur:e=>{return r(e.target.value.trim().length>0&&(t=e.target.value.trim(),!/^[*]+$/.test(t))?e.target.value.trim():null);var t}}),t.jsx(Gt,{country:n,className:"badge badge-xs badge-primary"})]})]})},Xt=({rank:e})=>t.jsxs("div",{className:"text-xs font-mono justify-self-end",children:[("0"+(e+1)).slice(-2),"."]}),Ht=({rank:e,name:s,country:r=null})=>t.jsxs("div",{className:n(["truncate text-primary",{"text-sm sm:text-base font-bold":0===e,"text-xs sm:text-sm":e<10,"text-xs":e>=10}]),children:[t.jsx(Gt,{country:r,className:"badge badge-xs badge-primary align-text-top hidden sm:inline-block me-1 sm:me-2"}),s]}),Yt=({rank:e,cols:s,rows:r,difficulty:a,seed:o})=>{const{t:i}=l(),{setSeed:c,setCols:d,setRows:u,setDifficulty:m,setIsDrawerShown:g}=Oe();return t.jsx(t.Fragment,{children:t.jsx("button",{type:"button",className:n(["btn btn-xs btn-link","!block text-base-300 max-w-full no-underline truncate","hover:!no-underline hover:text-accent",e<10?"text-xs":"text-xxs"]),"aria-label":i("play-this-game"),title:`${i("grid")}: ${s}×${r} - ${i("difficulty")}: ${i(`difficulties.${a}`)} - ${i("seed")}: ${o}`,onClick:()=>{c(o),d(s),u(r),m(a),g(!1)},children:t.jsxs("span",{children:[t.jsx(W,{className:"text-svg me-0.5"}),o]})})})},Wt=({score:e})=>{const{number:s}=Ze();return t.jsx("div",{className:"font-mono text-nowrap text-xs text-secondary",children:s(e)})},Zt=({time:e})=>t.jsx(it,{timeUnits:Ke(e),units:"abbr",separator:!1,className:"flex flex-nowrap gap-1 justify-self-end font-mono text-xs text-secondary"}),Jt=({date:s})=>{const{date:n}=(()=>{const{i18n:t}=l(),s=e=>e?new Date(e):new Date,n=e.useCallback((e,n)=>{try{return s(e).toLocaleDateString(t.language,n)}catch(r){return s(e).toLocaleDateString(we.locale.allowed.default,n)}},[t.language]);return{format:n,date:e=>n(e,{year:"numeric",month:"2-digit",day:"2-digit"}),textDate:e=>n(e,{year:"numeric",month:"long",day:"numeric"}),textDateShort:e=>n(e,{year:"numeric",month:"short",day:"numeric"}),datetime:e=>n(e,{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}).replace(", "," "),textDatetime:e=>n(e,{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"}).replace(", "," "),textDatetimeShort:e=>n(e,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"}).replace(", "," ")}})();return s?t.jsx("div",{className:"text-xxs leading-none font-mono justify-self-end",children:n(s.toString())}):null},Qt=({rank:e,date:s,name:r,country:a=null,score:o,rating:i,cols:l,rows:c,difficulty:d,seed:u,time:m})=>t.jsxs(t.Fragment,{children:[e>0?t.jsx("div",{className:"col-span-5 border-t border-dashed border-base-300"}):null,t.jsx(Xt,{rank:e}),e<10?t.jsx(ct,{name:r,country:a,className:n(["justify-self-center",0===e?"w-[2.8rem] md:w-[3.5rem]":"w-[2.1rem] md:w-[2.8rem]"])}):null,t.jsxs("div",{className:n({"col-span-2 ps-2 md:ps-3":e>=10}),children:[t.jsx(Ht,{rank:e,name:r,country:a}),t.jsx(Yt,{rank:e,cols:l,rows:c,difficulty:d,seed:u})]}),t.jsxs("div",{className:"flex flex-col items-end",children:[t.jsx(Zt,{time:m}),t.jsx(Jt,{date:s instanceof de?s.toDate().toString():void 0})]}),t.jsxs("div",{className:"flex flex-col items-center",children:[t.jsx(Wt,{score:o}),t.jsx(Ft,{rating:i,hasTransition:!1,stroke:"stroke-2 stroke-secondary",fill:"fill-secondary",className:"text-xxs"})]})]}),es=()=>{const{t:e}=l(),{difficulty:s,cols:n,rows:r}=Oe();return t.jsxs("div",{className:"flex gap-0.5 mb-5",children:[t.jsxs("span",{className:"badge badge-sm badge-outline badge-primary rounded-sm gap-1 font-bold",children:[t.jsx(L,{className:"text-svg"}),`${n}×${r}`]}),t.jsxs("span",{className:"badge badge-sm badge-outline badge-primary rounded-sm gap-1 font-bold",children:[t.jsx(at,{difficulty:s}),e(`difficulties.${s}`)]})]})},ts=({show:s})=>{const{getDocuments:n,docs:r,isLoading:a,error:o}=Pt("leaderboard"),{difficulty:i,cols:l,rows:c}=Oe();return e.useEffect(()=>{s&&n([ue("prod","==",!0),ue("name",">=",""),ue("name","<=",""),ue("difficulty","==",i),ue("cols","==",l),ue("rows","==",c),ue("time",">",0),ue("score",">",0),ue("rating",">",0),me("score","desc"),me("time","asc"),me("name","asc"),ge(10)])},[n,s,i,l,c]),t.jsxs(t.Fragment,{children:[t.jsx(es,{}),a?t.jsx("div",{className:"loading loading-infinity loading-xl"}):o?t.jsxs("div",{className:"text-error",children:[t.jsx(Y,{className:"text-svg text-3xl mb-1"}),t.jsx("div",{className:"text-xs font-bold text-wrap break-words",children:o})]}):r.length>0?t.jsx("div",{className:"grid grid-cols-[min-content_min-content_minmax(100px,1fr)_min-content_min-content] gap-x-2 sm:gap-x-5 gap-y-1 md:gap-y-2 justify-items-stretch items-center",children:r.map((e,s)=>e?t.jsx(Qt,{rank:s,...e},s):null)}):t.jsx(ne,{className:"text-svg text-3xl text-secondary"})]})},ss=()=>{const s=e.useRef(null),{t:r}=l(),{seed:a,setSeed:o,isRefreshing:i,showEffects:c}=Oe(),{play:d}=He(),[u,m]=e.useState(""),[g,f]=e.useState(!1),p=e.useCallback(e=>{o(u),e.preventDefault(),s.current?.blur()},[u,o]);return e.useEffect(()=>m(a),[a]),t.jsxs("form",{className:"flex flex-col sm:flex-row gap-1",onSubmit:p,children:[t.jsxs("label",{className:n(["input input-primary w-full",{"!border-primary/50":i||g}]),children:[t.jsx("strong",{className:"text-accent",children:r("seed")}),t.jsx("input",{ref:s,type:"text",value:u,disabled:i||g,onChange:e=>{d("grid-block-over"),m(Se(e.target.value))},onFocus:()=>m(""),onBlur:e=>{0===e.target.value.trim().length&&m(a)}}),t.jsx("button",{type:"button",className:n(["cursor-pointer",g?"text-secondary":"text-accent hover:text-accent/50",{"transition-[color] duration-400":c}]),"aria-label":r("refresh"),onPointerEnter:()=>d("grid-block-over"),onClick:()=>{i||g||(o(),f(!0))},disabled:g,children:t.jsx(A,{className:n(["w-full pointer-events-none",{"duration-500":c,"transition-[rotate] -rotate-360":c&&(i||g),"transition-none rotate-0":!i&&!g}]),onTransitionEnd:()=>f(!1)})})]}),t.jsx("button",{type:"submit",className:"btn btn-primary",disabled:0===u.length||u===a,"aria-label":r("use-this-seed"),onPointerEnter:()=>d("grid-block-over"),children:t.jsx(re,{className:"w-full"})})]})},ns=()=>{const{t:s}=l(),{setDifficulty:n,difficulty:r}=Oe(),{play:a}=He(),o=e.useRef(["easy","medium","hard"]);return t.jsx("div",{className:"flex flex-wrap gap-0.5 justify-stretch",children:o.current.map(e=>t.jsxs("button",{className:"flex-1 btn btn-sm btn-outline btn-primary disabled:!bg-accent disabled:!text-white",type:"button",disabled:e===r,"aria-lavel":s(`difficulties.${e}`),onPointerEnter:()=>a("grid-block-over"),onClick:()=>{a("grid-block-correct"),n(e)},children:[t.jsx(at,{difficulty:e,className:"text-xl hidden md:block"}),s(`difficulties.${e}`)]},e))})},rs=({label:s,value:r,showValue:a,min:o,max:i,step:l=1,help:c,onChange:d})=>{const{showEffects:u}=Oe(),{play:m}=He(),[g,f]=e.useState(!1),[p,x]=e.useState(!1),h=e.useRef(null),b=()=>{null!==h.current&&(clearTimeout(h.current),h.current=null)};return e.useEffect(()=>(b(),x(!0),h.current=setTimeout(()=>x(!1),700),()=>b()),[r]),t.jsxs("div",{children:[t.jsxs("div",{className:"indicator indicator-middle flex w-full",children:[t.jsxs("span",{className:n(["indicator-item gap-1 left-0 translate-x-1 -translate-y-1/2","badge badge-xs badge-accent pointer-events-none",{"transition-[background-color,opacity,border-color,color] duration-300 backdrop-blur-xs":u,"opacity-50":g,"bg-accent/0 border-base-content text-base-content opacity-100":g&&p}]),children:[s,": ",t.jsx("strong",{children:a??r})]}),t.jsx("input",{type:"range",className:n(["range w-full",g&&p?"range-accent":"range-primary"]),min:o,max:i,step:l,value:r,onPointerEnter:()=>{m("grid-block-over"),f(!0)},onPointerLeave:()=>f(!1),onPointerUp:()=>m("grid-block-correct"),onChange:e=>d(Number(e.target.value))})]}),c?t.jsxs("span",{className:"text-xs hidden md:block text-primary mt-1",children:[t.jsx(ae,{className:"text-svg"})," ",c]}):null]})},as=({label:s,icon:r,iconOff:a,checked:o,disabled:i=!1,onChange:l})=>{const{play:c}=He(),d={className:"text-svg text-lg"};return e.useEffect(()=>{i&&l(!1)},[i,l]),t.jsxs("label",{className:n(["flex gap-2 items-center max-w-fit","text-xs font-bold",i?"cursor-not-allowed":"cursor-pointer",o?"text-secondary":"text-base-content/50",i?"opacity-50":"hover:opacity-80"]),onPointerEnter:()=>i?null:c("grid-block-over"),children:[t.jsx("input",{type:"checkbox",className:"toggle toggle-sm toggle-secondary disabled:opacity-100",checked:o,disabled:i,onChange:e=>{i||(c("grid-block-correct"),l(e.target.checked))}}),r?t.jsxs(t.Fragment,{children:[r&&a?o?e.cloneElement(r,d):e.cloneElement(a,d):e.cloneElement(r,d)," "]}):null,t.jsx("span",{children:s})]})},os=()=>{const{t:s}=l(),{setSeed:r,setRows:a,setCols:o,setDifficulty:i,showEffects:c}=Oe(),{play:d}=He(),[u,m]=e.useState(!1),g=e.useRef(["easy","medium","hard"]),f=e.useRef(null),p=()=>Math.floor(Math.random()*(we.game.grid.max-we.game.grid.min+1)+we.game.grid.min),x=()=>{null!==f.current&&(clearTimeout(f.current),f.current=null)},h=e.useCallback(()=>{if(!u)return x(),d("grid-block-correct"),m(!0),r(),a(p()),o(p()),i(g.current[Math.floor(Math.random()*g.current.length)]),f.current=setTimeout(()=>m(!1),500),()=>x()},[u,r,a,o,i,d]);return t.jsxs("button",{className:"flex-1 btn btn-outline btn-primary disabled:!bg-secondary disabled:text-white",type:"button",onPointerEnter:()=>d("grid-block-over"),"aria-label":s("randomize"),onClick:h,disabled:u,children:[t.jsx(oe,{className:n(["text-svg",{"duration-500":c,"transition-[rotate] rotate-360":c&&u,"transition-none rotate-0":!u}])}),s("randomize")]})},is=()=>{const{t:s}=l(),{copied:r,copyToClipboard:a}=(()=>{const[t,s]=e.useState(!1);return{copyToClipboard:async e=>{try{await navigator.clipboard.writeText(e),s(!0),setTimeout(()=>s(!1),2e3)}catch(t){s(!1)}},copied:t}})(),{play:o}=He();return t.jsxs("button",{type:"button",className:n(["btn flex-1",r?"btn-accent":"btn-outline btn-primary"]),"aria-label":s("clipboard.copyUrl"),onPointerEnter:()=>o("grid-block-over"),onClick:()=>{o("grid-block-correct"),a(window.location.href)},children:[r?t.jsx(re,{className:"text-svg"}):t.jsx(ie,{className:"text-svg"})," ",s(r?"clipboard.copied":"clipboard.copyUrl")]})},ls=()=>{const{t:e}=l(),{rows:s,cols:n,isAuto:r,showIntersections:a,showEffects:o,isLeaderboardOn:i,isMusicOn:c,setRows:d,setCols:u,setIsAuto:m,setShowIntersections:g,setShowEffects:f,setIsLeaderboardOn:p,setIsMusicOn:x}=Oe(),{scale:h,setScale:b}=Te(),{percentage:y}=Ze(),{currentBreakpoint:v}=Re();return t.jsxs(t.Fragment,{children:[t.jsx(ss,{}),t.jsxs("div",{className:"flex flex-col gap-1",children:[t.jsx(rs,{label:e("size.width"),value:n,min:we.game.grid.min,max:we.game.grid.max,onChange:u}),t.jsx(rs,{label:e("size.height"),value:s,min:we.game.grid.min,max:we.game.grid.max,onChange:d})]}),t.jsx(ns,{}),t.jsx(rs,{label:e("scale"),value:h,showValue:y(h),min:we.game.scale.min,max:we.game.scale.max,step:we.game.scale.step,help:t.jsxs(t.Fragment,{children:[t.jsxs("kbd",{className:"kbd kbd-xs",children:[t.jsx(le,{className:"text-svg me-1"})," shift"]})," ","+ ",e("scrollwheel")]}),onChange:b}),t.jsxs("div",{className:"flex flex-wrap gap-0.5",children:[t.jsx(os,{}),t.jsx(is,{})]}),t.jsxs("div",{className:"flex flex-col flex-wrap gap-2",children:[t.jsx(as,{label:e("music"),icon:t.jsx(z,{}),iconOff:t.jsx(q,{}),checked:c,onChange:x}),t.jsx(as,{label:e("effects"),icon:t.jsx(B,{}),iconOff:t.jsx(V,{}),checked:o,onChange:f}),t.jsx(as,{label:e("auto"),icon:t.jsx(U,{}),iconOff:t.jsx(G,{}),checked:r,disabled:["xs","sm"].includes(v),onChange:m}),t.jsx(as,{label:e("intersections"),icon:t.jsx(K,{}),iconOff:t.jsx(X,{}),checked:a,disabled:["xs","sm"].includes(v),onChange:g}),t.jsx(as,{label:e("saveLeaderboard"),icon:t.jsx(H,{}),iconOff:t.jsx(Y,{}),checked:i,onChange:p})]})]})},cs=()=>{const{t:e}=l();return t.jsx("div",{className:"text-xs text-primary",children:t.jsx(c,{i18nKey:"footer.copyright",values:{year:(new Date).getFullYear(),author:e("footer.author")},components:{buttonAuthor:t.jsx("button",{type:"button",className:"link hover:text-accent font-bold","aria-label":e("footer.website"),onClick:()=>Le(e("footer.website"))}),buttonGitHub:t.jsx("button",{type:"button",className:"link hover:text-accent font-bold","aria-label":e("footer.github"),onClick:()=>Le(e("footer.github"))}),buttonRepo:t.jsx("button",{type:"button",className:"link hover:text-accent font-bold","aria-label":e("footer.repository"),onClick:()=>Le(e("footer.repository"))})}})})},ds=()=>{const{t:e}=l(),{isDrawerShown:s,setIsDrawerShown:r,showEffects:a,isLeaderboardOn:o}=Oe();return t.jsx(xt,{mountIf:s,timeout:a?500:0,children:({isEntering:s,status:i})=>t.jsxs("div",{className:"drawer fixed inset-0 z-10",children:[t.jsx("button",{type:"button",className:n(["drawer-overlay overlay hover:bg-primary/80 group","fixed inset-0 cursor-pointer",s?"opacity-100":"opacity-0",{"transition-[background-color,opacity] duration-250":a,"pointer-events-none":!["entering","done"].includes(i)}]),"aria-label":e("close-settings"),onClick:()=>r(!1),children:t.jsx(W,{className:"text-svg text-4xl md:text-6xl absolute top-1/2 right-5 md:right-10 -translate-y-1/2 text-base-100 opacity-50 group-hover:opacity-100 transition-opacity duration-150 ease-in-out"})}),t.jsx("div",{className:"absolute inset-0 overflow-y-auto pointer-events-none",children:t.jsx("div",{className:n(["drawer-side will-change-transform","absolute top-0 left-0","bg-base-200 text-base-content","w-[85vw] md:w-[65vw] lg:w-[50vw] xl:w-[45vw]","min-w-xs max-w-[900px] min-h-full","p-5 md:p-10 pointer-events-auto",s?"translate-x-0":"-translate-x-full",{"transition-transform duration-500":a}]),children:t.jsxs("div",{className:"flex flex-col gap-7 md:gap-10",children:[t.jsx(st,{size:"lg"}),t.jsx(Vt,{show:s,children:t.jsx(Kt,{})}),t.jsx(ls,{}),o?t.jsx(Vt,{show:s,label:e("leaderboard.title"),children:t.jsx(ts,{show:"done"===i})}):null,t.jsx(cs,{})]})})})]})})},us=()=>{const{add:s}=He();return e.useEffect(()=>{s("grid-refresh","./sounds/grid-refresh.mp3",.3),s("grid-block-over","./sounds/grid-block-over.mp3",.05),s("grid-block-correct","./sounds/grid-block-correct.mp3",.3),s("grid-block-wrong","./sounds/grid-block-wrong.mp3",.5),s("ending-loss","./sounds/ending-loss.mp3"),s("ending-victory","./sounds/ending-victory.mp3")},[s]),t.jsxs(t.Fragment,{children:[t.jsx(et,{}),t.jsxs("div",{className:"app flex flex-col min-w-xs select-none text-base-content",children:[t.jsx(Je,{}),t.jsx(Bt,{})]}),t.jsx(ds,{})]})},ms=async({iso:e,ns:t})=>{let s={};try{s=await((e,t,s)=>{const n=e[t];return n?"function"==typeof n?n():Promise.resolve(n):new Promise((e,n)=>{("function"==typeof queueMicrotask?queueMicrotask:setTimeout)(n.bind(null,new Error("Unknown variable dynamic import: "+t+(t.split("/").length!==s?". Note that variables only represent file names one level deep.":""))))})})(Object.assign({"./en-GB/default.json":()=>pe(()=>import("./default-Bu3lquy7.js"),[])}),`./${e}/${t}.json`,3)}catch(n){}return s};d.use(u).use(m).init({ns:we.locale.groups.list,defaultNS:we.locale.groups.default,resources:await(async()=>{const e={},t=we.locale.allowed.list.map(async t=>{e[t]={},await Promise.all(we.locale.groups.list.map(async s=>{e[t][s]=await ms({iso:t,ns:s})}))});return await Promise.all(t),e})(),fallbackLng:we.locale.allowed.default,supportedLngs:we.locale.allowed.list,returnEmptyString:!0,debug:!1,interpolation:{escapeValue:!1},parseMissingKeyHandler:()=>""}),a.createRoot(document.getElementById("root")).render(t.jsx(We,{children:t.jsx(us,{})}));
